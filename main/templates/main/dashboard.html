<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Fuel Refund Institute</title>
    <!-- Added favicon link as requested -->
    <link rel="icon" href="/static/images/logo.jpg" type="image/jpeg">
    <!-- Consolidated FontAwesome CSS links to avoid duplication -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/js/all.min.js" defer></script>
 <style>
    /* Optimized CSS with specified color theme */
:root {
  --deep-blue: #001E77; /* (0, 30, 119) Used for text ("FUEL") and nozzle */
  --deep-blue-hover: #00165a;
  --bright-red-orange: #FF3C1F; /* (255, 60, 31) Left arrow and "REFUND INSTITUTE" */
  --bright-red-orange-hover: #e52d10;
  --vibrant-orange-yellow: #FFB300; /* (255, 179, 0) Right arrow and orange droplet */
  --vibrant-orange-yellow-hover: #e6a200;
  --sky-blue: #00B9F2; /* (0, 185, 242) Left arrow and blue droplet */
  --sky-blue-hover: #0095c5;
  --white: #FFFFFF; /* (255, 255, 255) Background */
  --light-gray: #f7f9fc;
  --dark-gray: #333333;
  --medium-gray: #666666;
  --soft-shadow: 0 4px 12px rgba(0,0,0,0.08);
  --btn-shadow: 0 4px 6px rgba(0,0,0,0.1);
  --success-green: #28a745;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
  color: var(--dark-gray);
  line-height: 1.6;
  font-size: 16px;
  background-color: var(--white);
}

.container {
  max-width: 1200px;
  margin: 0 auto;
  padding: 0 20px;
}

h1, h2, h3, h4, h5, h6 {
  font-weight: 600;
  line-height: 1.3;
  color: var(--deep-blue);
}

a {
  text-decoration: none;
  color: var(--deep-blue);
  transition: color 0.3s;
}

a:hover {
  color: var(--bright-red-orange);
}

p {
  margin-bottom: 1rem;
}

img {
  max-width: 100%;
  height: auto;
}

/* Header */
header {
  background-color: var(--white);
  box-shadow: 0 1px 3px rgba(0,0,0,0.1);
  position: sticky;
  top: 0;
  z-index: 100;
  padding: 16px 0;
}

.header-content {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.logo-container {
  display: flex;
  align-items: center;
  gap: 12px;
}

.logo {
  width: 44px;
  height: 44px;
  background-color: var(--deep-blue);
  border-radius: 8px;
  display: flex;
  align-items: center;
  justify-content: center;
  color: var(--white);
  font-weight: bold;
  font-size: 20px;
  overflow: hidden; /* Added to contain the image */
}

/* Added styling for the logo image */
.logo img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.company-name {
  font-size: 18px;
  font-weight: 700;
}

.company-name .fuel {
  color: var(--deep-blue);
}

.company-name .refund {
  color: var(--bright-red-orange);
}

.nav-links {
  display: flex;
  align-items: center;
  gap: 24px;
}

.nav-links a {
  color: var(--dark-gray);
  font-weight: 500;
  font-size: 15px;
  padding: 8px 4px;
  position: relative;
}

.nav-links a:after {
  content: '';
  position: absolute;
  width: 0;
  height: 2px;
  bottom: 0;
  left: 0;
  background-color: var(--bright-red-orange);
  transition: width 0.3s;
}

.nav-links a:hover {
  color: var(--bright-red-orange);
}

.nav-links a:hover:after {
  width: 100%;
}

/* Button Styles */
.btn {
  display: inline-block;
  color: var(--white);
  padding: 10px 20px;
  border-radius: 6px;
  font-weight: 600;
  font-size: 15px;
  transition: transform 0.3s;
  border: none;
  cursor: pointer;
  text-align: center;
  background-color: var(--deep-blue);
  box-shadow: var(--btn-shadow);
}

.btn:hover {
  transform: translateY(-2px);
  background-color: var(--deep-blue-hover);
  color: var(--white);
}

.btn-outline {
  background-color: transparent;
  color: var(--deep-blue);
  border: 2px solid var(--deep-blue);
  box-shadow: none;
}

.btn-outline:hover {
  background-color: var(--deep-blue);
  color: var(--white);
}

.btn-primary {
  background-color: var(--bright-red-orange);
  color: var(--white);
}

.btn-primary:hover {
  background-color: var(--bright-red-orange-hover);
}

.btn-secondary {
  background-color: var(--sky-blue);
  color: var(--white);
}

.btn-secondary:hover {
  background-color: var(--sky-blue-hover);
}

/* Logout button */
.btn-logout {
  color: var(--dark-gray);
  padding: 10px 20px;
  border-radius: 6px;
  font-weight: 600;
  background-color: transparent;
  transition: color 0.3s;
  border: none;
  display: inline-block;
}

.btn-logout:hover {
  color: var(--bright-red-orange);
}

/* Main Content */
.main-content {
  padding: 40px 0;
  background-color: var(--light-gray);
}

.welcome-header {
  margin-bottom: 30px;
  position: relative;
  padding-bottom: 16px;
}

.welcome-header:after {
  content: '';
  position: absolute;
  bottom: 0;
  left: 0;
  width: 60px;
  height: 3px;
  background-color: var(--bright-red-orange);
}

.welcome-header h2 {
  color: var(--deep-blue);
  font-size: 28px;
  margin-bottom: 8px;
}

/* Cards */
.card {
  background-color: var(--white);
  border-radius: 10px;
  box-shadow: var(--soft-shadow);
  margin-bottom: 30px;
  overflow: hidden;
  transition: transform 0.3s, box-shadow 0.3s;
}

.card:hover {
  transform: translateY(-5px);
  box-shadow: 0 12px 24px rgba(0,0,0,0.1);
}

.card-header {
  background: var(--deep-blue);
  color: var(--white);
  padding: 20px;
  font-size: 18px;
  font-weight: 600;
}

.card-body {
  padding: 25px;
}

/* User Info Table */
.info-table {
  width: 100%;
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 15px;
}

.info-item {
  display: flex;
  flex-direction: column;
  padding: 10px;
  background-color: var(--light-gray);
  border-radius: 6px;
}

.info-label {
  color: var(--medium-gray);
  font-weight: 600;
  font-size: 14px;
  margin-bottom: 5px;
}

.info-value {
  color: var(--dark-gray);
  font-weight: 500;
}

/* Form Styles */
.upload-form {
  margin-top: 20px;
}

.form-group {
  margin-bottom: 20px;
}

.form-group label {
  display: block;
  margin-bottom: 8px;
  font-weight: 500;
  color: var(--deep-blue);
}

.form-control {
  width: 100%;
  padding: 12px;
  border: 1px solid #ddd;
  border-radius: 6px;
  font-size: 16px;
  transition: border-color 0.3s, box-shadow 0.3s;
}

.form-control:focus {
  outline: none;
  border-color: var(--sky-blue);
  box-shadow: 0 0 0 2px rgba(0, 185, 242, 0.2);
}

.btn-submit {
  background-color: var(--sky-blue);
  color: var(--white);
  border: none;
  padding: 12px 24px;
  border-radius: 6px;
  font-weight: 600;
  cursor: pointer;
  transition: transform 0.3s, background-color 0.3s;
  box-shadow: var(--btn-shadow);
}

.btn-submit:hover {
  background-color: var(--sky-blue-hover);
  transform: translateY(-2px);
}

/* Document List */
.document-list {
  list-style: none;
  padding: 0;
  margin: 20px 0 0;
}

.document-list li {
  padding: 15px;
  border-bottom: 1px solid var(--light-gray);
  display: flex;
  justify-content: space-between;
  align-items: center;
  transition: background-color 0.3s;
}

.document-list li:last-child {
  border-bottom: none;
}

.document-list li:hover {
  background-color: var(--light-gray);
}

.document-list a {
  color: var(--deep-blue);
  font-weight: 500;
  display: flex;
  align-items: center;
  gap: 8px;
}

.document-list a i {
  color: var(--vibrant-orange-yellow);
}

.document-list a:hover {
  color: var(--bright-red-orange);
}

.document-actions {
  display: flex;
  gap: 15px;
}

.document-actions a {
  color: var(--medium-gray);
  font-size: 14px;
  transition: color 0.2s;
  display: flex;
  align-items: center;
  gap: 5px;
}

.document-actions a:hover {
  color: var(--bright-red-orange);
}

.document-actions .delete-action {
  color: var(--bright-red-orange);
}

.document-actions .delete-action:hover {
  color: #e12f15;
}

.no-documents {
  color: var(--medium-gray);
  text-align: center;
  padding: 20px;
  background-color: var(--light-gray);
  border-radius: 6px;
  font-style: italic;
}

/* Complete Status Message */
.complete-status {
  background-color: var(--light-gray);
  border-left: 5px solid var(--success-green);
  padding: 25px;
  border-radius: 8px;
  margin: 20px 0;
  transition: transform 0.3s, box-shadow 0.3s;
}

.complete-status:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 16px rgba(0,0,0,0.08);
}

.complete-status h3 {
  color: var(--success-green);
  margin-top: 0;
  display: flex;
  align-items: center;
  margin-bottom: 15px;
}

.complete-status h3 i {
  margin-right: 10px;
  font-size: 24px;
}

.complete-status p {
  margin: 10px 0;
  color: var(--dark-gray);
  line-height: 1.6;
}

.contact-info {
  background-color: var(--white);
  padding: 20px;
  border-radius: 8px;
  margin-top: 20px;
  box-shadow: var(--soft-shadow);
}

.contact-info strong {
  color: var(--deep-blue);
}

/* File Upload Zone */
.drop-zone {
  border: 2px dashed #ccc;
  border-radius: 8px;
  padding: 30px;
  text-align: center;
  cursor: pointer;
  transition: border-color 0.3s, background-color 0.3s;
  margin-bottom: 25px;
}

.drop-zone:hover {
  border-color: var(--sky-blue);
  background-color: rgba(0, 185, 242, 0.05);
}

.drop-zone i {
  font-size: 40px;
  color: var(--sky-blue);
  margin-bottom: 15px;
}

.drop-zone h3 {
  margin-bottom: 10px;
  color: var(--deep-blue);
}

.drop-zone p {
  margin: 5px 0;
  color: var(--medium-gray);
}

.drop-zone .btn-browse {
  display: inline-block;
  background-color: var(--sky-blue);
  color: var(--white);
  padding: 10px 20px;
  border-radius: 6px;
  margin-top: 15px;
  font-weight: 500;
  transition: transform 0.3s, background-color 0.3s;
}

.drop-zone .btn-browse:hover {
  background-color: var(--sky-blue-hover);
  transform: translateY(-2px);
}

/* Progress Bar */
.progress-container {
  margin: 25px 0;
}

.progress-bar {
  background-color: var(--light-gray);
  border-radius: 6px;
  height: 10px;
  overflow: hidden;
}

.progress-fill {
  height: 100%;
  background: linear-gradient(to right, var(--sky-blue), var(--bright-red-orange));
  transition: width 0.3s;
}

.progress-text {
  display: flex;
  justify-content: space-between;
  margin-top: 8px;
  font-size: 14px;
  color: var(--medium-gray);
}

/* Alert Messages */
.alert {
  padding: 15px 20px;
  margin-bottom: 25px;
  border-radius: 8px;
  display: flex;
  align-items: center;
  box-shadow: var(--soft-shadow);
}

.alert i {
  margin-right: 15px;
  font-size: 20px;
}

.alert-success {
  background-color: rgba(40, 167, 69, 0.1);
  border-left: 4px solid var(--success-green);
  color: var(--success-green);
}

.alert-warning {
  background-color: rgba(255, 179, 0, 0.1);
  border-left: 4px solid var(--vibrant-orange-yellow);
  color: #856404;
}

.alert-error {
  background-color: rgba(255, 60, 31, 0.1);
  border-left: 4px solid var(--bright-red-orange);
  color: var(--bright-red-orange);
}

/* Selected files box */
.selected-files-container {
  margin-top: 20px;
  border: 1px solid #ddd;
  border-radius: 8px;
  padding: 15px;
  max-height: 200px;
  overflow-y: auto;
  background-color: var(--light-gray);
}

.selected-files-container h4 {
  margin-bottom: 10px;
  color: var(--deep-blue);
}

.selected-file {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 8px 0;
  border-bottom: 1px solid #eee;
}

.selected-file:last-child {
  border-bottom: none;
}

.selected-file i {
  color: var(--vibrant-orange-yellow);
  margin-right: 8px;
}

.file-size {
  color: var(--medium-gray);
  font-size: 12px;
  margin-left: 5px;
}

/* Footer */
footer {
  background: var(--deep-blue);
  color: var(--white);
  padding: 30px 0;
  margin-top: 60px;
}

.footer-content {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.footer-links {
  display: flex;
  gap: 20px;
}

.footer-links a {
  color: rgba(255, 255, 255, 0.8);
  transition: color 0.3s;
}

.footer-links a:hover {
  color: var(--white);
}

.copyright {
  opacity: 0.8;
  font-size: 14px;
}

/* Back to top button */
.back-to-top {
  position: fixed;
  bottom: 24px;
  right: 24px;
  width: 40px;
  height: 40px;
  background-color: var(--bright-red-orange);
  color: var(--white);
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  box-shadow: 0 4px 8px rgba(0,0,0,0.2);
  opacity: 0;
  transform: translateY(10px);
  transition: opacity 0.3s, transform 0.3s;
  z-index: 99;
}

.back-to-top:hover {
  background-color: var(--bright-red-orange-hover);
}

/* Responsive */
@media (max-width: 768px) {
  .container {
    padding: 0 20px;
  }

  .header-content {
    flex-direction: column;
    gap: 15px;
  }
  
  .nav-links {
    margin-top: 15px;
  }
  
  .footer-content {
    flex-direction: column;
    gap: 20px;
  }
  
  .document-list li {
    flex-direction: column;
    align-items: flex-start;
    gap: 10px;
  }
  
  .document-actions {
    margin-top: 10px;
  }

  .card-header {
    padding: 15px 20px;
  }

  .card-body {
    padding: 20px;
  }

  .drop-zone {
    padding: 20px;
  }
  
  .info-table {
    grid-template-columns: 1fr;
  }
}
 </style>
</head>
<body>
    <!-- Header -->
    <header>
        <div class="container">
            <div class="header-content">
                <div class="logo-container">
                    <div class="logo">
                        <!-- Added logo image -->
                        <img src="/static/images/logo.jpg" alt="FRI Logo">
                    </div>
                    <div class="company-name">
                        <span class="fuel">FUEL</span> <span class="refund">REFUND INSTITUTE</span>
                    </div>
                </div>
                
                <div class="nav-links">
                    <a href="/">Home</a>
                    <a href="/contact">Contact</a>
                    <a href="{% url 'logout' %}" class="btn-logout">Logout</a>
                </div>
            </div>
        </div>
    </header>
    
    <!-- Main Content -->
    <div class="main-content">
        <div class="container">
            <div class="welcome-header">
                <h2>Welcome, {{ user.username }}</h2>
                <p>Manage your refund claims and documents from your personal dashboard.</p>
            </div>
            
            <!-- Messages -->
            {% if messages %}
                {% for message in messages %}
                    <div class="alert {% if message.tags %}alert-{{ message.tags }}{% endif %}">
                        <i class="fas {% if message.tags == 'success' %}fa-check-circle{% elif message.tags == 'warning' %}fa-exclamation-triangle{% elif message.tags == 'error' %}fa-times-circle{% else %}fa-info-circle{% endif %}"></i>
                        {{ message }}
                    </div>
                {% endfor %}
            {% endif %}
            
            <!-- User Information Card -->
            <div class="card">
                <div class="card-header">Your Information</div>
                <div class="card-body">
                    <div class="info-table">
                        <div class="info-item">
                            <div class="info-label">Full Name</div>
                            <div class="info-value">Ethan Ocean Sevenster</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Email</div>
                            <div class="info-value">ethansevenster621@gmail.com</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Phone</div>
                            <div class="info-value">0761235651</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">SSN</div>
                            <div class="info-value">89898989</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Business Name</div>
                            <div class="info-value">Ethan Butchery</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Business Type</div>
                            <div class="info-value">The Good Kind</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Tax ID</div>
                            <div class="info-value">12345</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Business Address</div>
                            <div class="info-value">Cape Town, Bellville</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Document Upload Card -->
            <div class="card">
                <div class="card-header">Document Upload</div>
                <div class="card-body">
                    <!-- Progress Bar -->
                    <div class="progress-container">
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: {% widthratio documents.count 7 100 %}%;"></div>
                        </div>
                        <div class="progress-text">
                            <span>{{ documents.count }} of 7 documents uploaded</span>
                            <span>{{ documents_remaining }} remaining</span>
                        </div>
                    </div>
                    
                    {% if documents_complete %}
                    <!-- Complete submission message -->
                    <div class="complete-status">
                        <h3><i class="fas fa-check-circle"></i> All Documents Submitted</h3>
                        <p>Thank you for uploading all required documents. Our tax consultants are now processing your refund claim.</p>
                        <p>You will receive an email notification when your claim has been processed, typically within 5-7 business days.</p>
                        
                        <div class="contact-info">
                            <p>If you need immediate assistance or have questions about your submission:</p>
                            <p><strong>Phone:</strong> (800) 555-1234</p>
                            <p><strong>Email:</strong> claims@fuelrefundinstitute.com</p>
                            <p><strong>Office Hours:</strong> Monday-Friday, 8:00 AM - 5:00 PM PST</p>
                        </div>
                    </div>
                    {% else %}
                    <p>Please upload up to 7 documents (PDF, image, or other). You can select multiple files at once.</p>
                    
                    <form method="post" enctype="multipart/form-data" class="upload-form">
                        {% csrf_token %}
                        
                        <div class="drop-zone" id="dropZone">
                            <i class="fas fa-cloud-upload-alt"></i>
                            <h3>Drag & Drop Files Here</h3>
                            <p>or</p>
                            <label class="btn-browse">
                                Browse Files
                                <input type="file" name="document" multiple style="display: none;" id="fileInput">
                            </label>
                        </div>
                        
                        <div class="selected-files-container" id="selectedFilesContainer" style="display: none;">
                            <h4>Selected Files:</h4>
                            <div id="selectedFiles"></div>
                        </div>
                        
                        <div class="form-group">
                            <label for="id_description">Description (applies to all files):</label>
                            <input type="text" name="description" id="id_description" class="form-control" placeholder="Optional description for your documents">
                        </div>
                        
                        <div style="text-align: right;">
                            <button type="submit" class="btn-submit">Upload Files</button>
                        </div>
                    </form>
                    {% endif %}
                    
                    {% if documents %}
                        <h3 style="margin-top: 30px;">Your Uploaded Documents</h3>
                        <ul class="document-list">
                            {% for doc in documents %}
                                <li>
                                    <div>
                                        <a href="{{ doc.document.url }}" target="_blank">
                                            <i class="fas fa-file"></i> {{ doc.display_name }}
                                        </a>
                                        {% if doc.description %}
                                        <div style="color: var(--medium-gray); font-size: 14px; margin-top: 5px;">
                                            {{ doc.description }}
                                        </div>
                                        {% endif %}
                                    </div>
                                    <div class="document-actions">
                                        <a href="{{ doc.document.url }}" target="_blank" title="View Document">
                                            <i class="fas fa-eye"></i> View
                                        </a>
                                        <a href="{% url 'delete_document' doc.id %}" 
                                           onclick="return confirm('Are you sure you want to delete this document? You can upload a replacement after deletion.');" 
                                           title="Delete Document" 
                                           class="delete-action">
                                            <i class="fas fa-trash-alt"></i> Delete
                                        </a>
                                    </div>
                                </li>
                            {% endfor %}
                        </ul>
                    {% else %}
                        <div class="no-documents">
                            <p>No documents uploaded yet.</p>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
    
    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="copyright">
                    &copy; 2025 Fuel Refund Institute. All rights reserved.
                </div>
                <div class="footer-links">
                    <a href="/">Home</a>
                    <a href="/contact">Contact</a>
                </div>
            </div>
        </div>
    </footer>

    <!-- Back to top button is now created in JS -->

    <!-- JavaScript for drag & drop and file selection UI - Optimized -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const dropZone = document.getElementById('dropZone');
            const fileInput = document.getElementById('fileInput');
            const selectedFilesContainer = document.getElementById('selectedFilesContainer');
            const selectedFiles = document.getElementById('selectedFiles');
            
            if(dropZone && fileInput) {
                // Prevent default drag behaviors
                ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                    dropZone.addEventListener(eventName, preventDefaults, false);
                    document.body.addEventListener(eventName, preventDefaults, false);
                });
                
                // Highlight drop zone when dragging over it
                ['dragenter', 'dragover'].forEach(eventName => {
                    dropZone.addEventListener(eventName, highlight, false);
                });
                
                ['dragleave', 'drop'].forEach(eventName => {
                    dropZone.addEventListener(eventName, unhighlight, false);
                });
                
                // Handle dropped files
                dropZone.addEventListener('drop', handleDrop, false);
                
                // Handle selected files through file input
                fileInput.addEventListener('change', handleFiles, false);
                
                // Click on drop zone to trigger file input
                dropZone.addEventListener('click', function() {
                    fileInput.click();
                });
                
                function preventDefaults(e) {
                    e.preventDefault();
                    e.stopPropagation();
                }
                
                function highlight(e) {
                    dropZone.classList.add('highlight');
                    dropZone.style.borderColor = '#00B9F2';
                    dropZone.style.backgroundColor = 'rgba(0, 185, 242, 0.05)';
                }
                
                function unhighlight(e) {
                    dropZone.classList.remove('highlight');
                    dropZone.style.borderColor = '#ccc';
                    dropZone.style.backgroundColor = '';
                }
                
                function handleDrop(e) {
                    const dt = e.dataTransfer;
                    const files = dt.files;
                    fileInput.files = files;
                    handleFiles();
                }
                
                function handleFiles() {
                    const files = fileInput.files;
                    updateFileList(files);
                }
                
                function updateFileList(files) {
                    if(files.length > 0) {
                        let fileList = '';
                        for(let i = 0; i < files.length; i++) {
                            fileList += `
                                <div class="selected-file">
                                    <div>
                                        <i class="fas fa-file"></i> ${files[i].name}
                                        <span class="file-size">(${formatFileSize(files[i].size)})</span>
                                    </div>
                                </div>`;
                        }
                        selectedFiles.innerHTML = fileList;
                        selectedFilesContainer.style.display = 'block';
                        
                        // Visual feedback in drop zone
                        dropZone.querySelector('h3').textContent = `${files.length} file(s) selected`;
                        dropZone.querySelector('i').className = 'fas fa-check-circle';
                        dropZone.style.borderColor = '#28a745';
                    } else {
                        selectedFiles.innerHTML = '';
                        selectedFilesContainer.style.display = 'none';
                        dropZone.querySelector('h3').textContent = 'Drag & Drop Files Here';
                        dropZone.querySelector('i').className = 'fas fa-cloud-upload-alt';
                    }
                }
                
                function formatFileSize(bytes) {
                    if(bytes === 0) return '0 Bytes';
                    const k = 1024;
                    const sizes = ['Bytes', 'KB', 'MB', 'GB'];
                    const i = Math.floor(Math.log(bytes) / Math.log(k));
                    return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
                }
            }
            
            // Calculate correct progress bar width
            const progressFill = document.querySelector('.progress-fill');
            if (progressFill) {
                const documentsCount = {{ documents.count }};
                const percentage = (documentsCount / 7) * 100;
                progressFill.style.width = percentage + '%';
            }
            
            // Create back to top button with improved efficiency
            const createBackToTop = () => {
                const backToTop = document.createElement('a');
                backToTop.href = '#';
                backToTop.className = 'back-to-top';
                backToTop.innerHTML = '<i class="fas fa-chevron-up"></i>';
                
                // Add event listener
                backToTop.addEventListener('click', e => {
                    e.preventDefault();
                    window.scrollTo({
                        top: 0,
                        behavior: 'smooth'
                    });
                });
                
                // Add scroll listener using throttling for better performance
                let lastScroll = 0;
                let ticking = false;
                
                window.addEventListener('scroll', () => {
                    lastScroll = window.scrollY;
                    if (!ticking) {
                        window.requestAnimationFrame(() => {
                            if (lastScroll > 300) {
                                backToTop.style.opacity = '1';
                                backToTop.style.transform = 'translateY(0)';
                            } else {
                                backToTop.style.opacity = '0';
                                backToTop.style.transform = 'translateY(10px)';
                            }
                            ticking = false;
                        });
                        ticking = true;
                    }
                });
                
                return backToTop;
            };
            
            // Add back to top button to the DOM
            document.body.appendChild(createBackToTop());
        });
    </script>
</body>
</html>